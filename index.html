<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ§¬ åˆ†å­æ¼”åŒ–åµæ¢ v5.0 (Netlify ç‰ˆ)</title>
<script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;500;700&family=Roboto+Mono:wght@400;600&display=swap" rel="stylesheet">

<style>
  :root { --primary: #2c3e50; --accent: #3498db; --ai: #8e44ad; --bg: #f4f7f6; }
  body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg); color: #333; margin: 0; padding: 20px; line-height: 1.6; }
  .container { max-width: 1000px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
  h1 { text-align: center; color: var(--primary); margin-bottom: 5px; }
  .subtitle { text-align: center; color: #666; font-size: 0.9em; margin-bottom: 25px; }

  /* å­¸ç”Ÿå§“åè¼¸å…¥æ¨£å¼ */
  .student-info-box { background: #e8f5e9; border: 1px solid #c8e6c9; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
  .name-input { flex-grow: 1; padding: 10px; border: 1px solid #aaa; border-radius: 4px; font-size: 16px; font-family: 'Noto Sans TC', sans-serif; }

  /* æ•¸æ“šå€å¡Šæ¨£å¼ */
  .section-box { border: 1px solid #ddd; border-radius: 8px; background: #fafafa; padding: 15px; margin-bottom: 20px; }
  .whale-box { border: 2px solid var(--accent); background-color: #f0f8ff; }
  .seq-display { font-family: 'Roboto Mono', monospace; font-size: 13px; background: #fff; border: 1px solid #ccc; padding: 5px; overflow-x: auto; white-space: nowrap; }
  .whale-input { width: 98%; height: 50px; font-family: 'Roboto Mono', monospace; margin-top:5px; }

  /* æŒ‰éˆ•èˆ‡åœ–è¡¨ */
  .action-btn { width: 100%; background-color: var(--primary); color: white; border: none; padding: 12px; font-size: 18px; border-radius: 50px; cursor: pointer; font-weight: bold; transition: 0.3s; margin-top: 10px; }
  .action-btn:hover { background-color: var(--accent); }
  #heatmap { width: 100%; min-height: 500px; }

  /* ä»»å‹™å¡ç‰‡æ¨£å¼ */
  .task-grid { display: grid; grid-template-columns: 1fr; gap: 20px; margin-top: 40px; }
  .task-card { background: white; border-left: 5px solid var(--ai); box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 8px; padding: 20px; position: relative; transition: transform 0.2s; animation: fadeIn 1s; }
  .task-card:hover { transform: translateY(-3px); }
  .task-title { font-weight: 700; color: var(--primary); font-size: 1.1em; display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
  .task-badge { background: var(--ai); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em; }
  .task-question { margin-bottom: 15px; color: #555; font-size: 0.95em; }
  .task-input { width: 95%; height: 60px; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-family: inherit; margin-bottom: 10px; }
  
  .ai-submit-btn { background-color: var(--ai); color: white; border: none; padding: 8px 20px; border-radius: 20px; cursor: pointer; font-size: 0.9em; display: inline-flex; align-items: center; gap: 5px; }
  .ai-submit-btn:hover { background-color: #7d3c98; }
  .ai-submit-btn:disabled { background-color: #ccc; cursor: not-allowed; }
  .ai-feedback { margin-top: 15px; padding: 15px; background: #f3e5f5; border-radius: 6px; border: 1px solid #e1bee7; color: #4a148c; display: none; font-size: 0.95em; }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  .loading { display: inline-block; width: 10px; height: 10px; border: 2px solid rgba(255,255,255,0.5); border-radius: 50%; border-top-color: #fff; animation: spin 1s linear infinite; }
  @keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>

<div class="container">
  <h1>ğŸ§¬ åˆ†å­æ¼”åŒ–åµæ¢ï¼šèƒºåŸºé…¸åºåˆ—æ¨¡æ“¬æ¯”å°åˆ†æç³»çµ±</h1>
  <div class="subtitle">æ•¸æ“šåˆ†æå·¥å…· X AI é˜¿å‡¡é”</div>

  <div class="student-info-box">
    <label style="font-weight:bold; color:#2e7d32;">ğŸ‘¤ ä½¿ç”¨è€…è­˜åˆ¥ï¼š</label>
    <input type="text" id="student-name" class="name-input" placeholder="è«‹åœ¨æ­¤è¼¸å…¥ï¼šç­ç´š-åº§è™Ÿ-å§“å (ä¾‹å¦‚ï¼š110-10-é˜¿å‡¡é”)">
  </div>
  <div class="section-box">
    <h3>ğŸ“š æ­¥é©Ÿ 1ï¼šé¸æ“‡æ¯”å°ç‰©ç¨® (å¯è‡ªè¡Œå‹¾é¸)</h3>
    <table style="width:100%"><tbody id="species-list-body"></tbody></table>
    <button onclick="toggleAll()" style="margin-top:5px; padding:2px 10px;">å…¨é¸</button>
  </div>

  <div class="section-box whale-box">
    <label style="font-weight:bold; color:var(--primary);">ğŸ‹ æ­¥é©Ÿ 2ï¼šè¼¸å…¥æ¬²æ¯”å°çš„åºåˆ—(ä»¥é¯¨é­šç‚ºä¾‹)</label>
    <textarea id="whale-input" class="whale-input">MGDVEKGKKIFVQKCAQCHTVEKGGKHKTGPNLHGLFGRKTGQAVGFSYTDANKNKGITWGEDTLMEYLENPKKYIPGTKMIFAGIKKKGERADLIAYLKKATNE</textarea>
  </div>

  <button class="action-btn" onclick="runAnalysis()">ğŸš€ æ­¥é©Ÿ 3ï¼šå•Ÿå‹•é‹ç®— (ç¹ªè£½ç†±åœ–)</button>

  <div id="result-area" style="display:none;">
    <hr>
    <h2 style="text-align:center;">ğŸ“Š åˆ†æçµæœï¼šæ¼”åŒ–è¦ªç·£ç†±åœ–</h2>
    <div id="heatmap"></div>

    <h2 style="text-align:center; margin-top:40px; color:var(--ai);">ğŸ“ é˜¿å‡¡é”çš„æŒ‘æˆ°ä»»å‹™</h2>
    <div class="task-grid">
      <div id="card-q1" class="task-card">
        <div class="task-title"><span class="task-badge">ä»»å‹™ 1</span> æ•¸æ“šè§€å¯Ÿå“¡</div>
        <p class="task-question">è«‹æŸ¥çœ‹ç†±åœ–ä¸Šçš„æ•¸å­—ï¼š<br>1. é¯¨é­š(Whale)èˆ‡é®ªé­š(Tuna)çš„ç›¸ä¼¼åº¦æ˜¯å¤šå°‘ï¼Ÿ<br>2. é¯¨é­šèˆ‡å°é¼ (Mouse)çš„ç›¸ä¼¼åº¦æ˜¯å¤šå°‘ï¼Ÿ<br>èª°çš„æ•¸å­—æ¯”è¼ƒé«˜ï¼Ÿ</p>
        <textarea id="ans-1" class="task-input" placeholder="è«‹è¼¸å…¥ä½ çœ‹åˆ°çš„æ•¸å€¼èˆ‡æ¯”è¼ƒçµæœ..."></textarea>
        <button class="ai-submit-btn" onclick="submitTask('q1', 'ans-1', 'fb-1', this, 'card-q2')">âœ¨ æäº¤æª¢æŸ¥</button>
        <div id="fb-1" class="ai-feedback"></div>
      </div>
      <div id="card-q2" class="task-card" style="display:none;">
        <div class="task-title"><span class="task-badge">ä»»å‹™ 2</span> æ¼”åŒ–æ¨ç†å¸«</div>
        <p class="task-question">æ‰¿ä¸Šé¡Œï¼Œæ—¢ç„¶é¯¨é­šè·Ÿå°é¼ çš„åŸºå› æ¯”è¼ƒåƒï¼Œç‚ºä»€éº¼é¯¨é­šé•·å¾—åƒé­šï¼Ÿé€™ä»£è¡¨é¯¨é­šåœ¨åˆ†é¡ä¸Šå±¬æ–¼å“ªä¸€é¡ï¼Ÿ</p>
        <textarea id="ans-2" class="task-input" placeholder="è«‹è§£é‡‹åŸå›  (é—œéµå­—ï¼šOOé¡ã€è¶¨Oæ¼”åŒ–)..."></textarea>
        <button class="ai-submit-btn" onclick="submitTask('q2', 'ans-2', 'fb-2', this, 'card-q3')">âœ¨ æäº¤æª¢æŸ¥</button>
        <div id="fb-2" class="ai-feedback"></div>
      </div>
      <div id="card-q3" class="task-card" style="display:none;">
        <div class="task-title"><span class="task-badge">ä»»å‹™ 3</span> æé¾çµäºº</div>
        <p class="task-question">è«‹æ¯”è¼ƒã€Œé› (Chicken)ã€èˆ‡ã€ŒéŸ¿å°¾è›‡ (Snake)ã€çš„ç›¸ä¼¼åº¦ã€‚é€™å€‹æ•¸æ“šæ˜¯å¦æ”¯æŒã€Œé³¥é¡æ˜¯æé¾(çˆ¬è¡Œé¡)æ¼”åŒ–ä¾†çš„ã€é€™å€‹èªªæ³•ï¼Ÿ</p>
        <textarea id="ans-3" class="task-input" placeholder="è«‹è§€å¯Ÿé›è·Ÿè›‡çš„ç›¸ä¼¼åº¦ï¼Œä¸¦èªªæ˜ä½ çš„çµè«–..."></textarea>
        <button class="ai-submit-btn" onclick="submitTask('q3', 'ans-3', 'fb-3', this, 'card-q4')">âœ¨ æäº¤æª¢æŸ¥</button>
        <div id="fb-3" class="ai-feedback"></div>
      </div>
      <div id="card-q4" class="task-card" style="display:none;">
        <div class="task-title"><span class="task-badge">ä»»å‹™ 4</span> å“²å­¸æ€è¾¨å®¶</div>
        <p class="task-question">çœ‹çœ‹ã€Œäººé¡ã€èˆ‡ã€Œé»‘çŒ©çŒ©ã€çš„ç›¸ä¼¼åº¦ï¼Œæ‡‰è©²æ˜¯ 100%ã€‚<br>å•é¡Œä¾†äº†ï¼šå¦‚æœèƒºåŸºé…¸åºåˆ—ä¸€æ¨¡ä¸€æ¨£ï¼Œç‚ºä»€éº¼æˆ‘å€‘é•·å¾—ä¸ä¸€æ¨£ï¼Ÿ(æç¤ºï¼šåŸºå› è¡¨ç¾é™¤äº†è£½é€ è›‹ç™½è³ªï¼Œé‚„æœ‰å…¶ä»–åŠŸèƒ½?)</p>
        <textarea id="ans-4" class="task-input" placeholder="è«‹ç™¼æ®æƒ³åƒåŠ›ï¼Œç‚ºä»€éº¼æˆä»½ä¸€æ¨£ï¼Œçµæœä¸åŒï¼Ÿ..."></textarea>
        <button class="ai-submit-btn" onclick="submitTask('q4', 'ans-4', 'fb-4', this, null)">âœ¨ æäº¤æª¢æŸ¥</button>
        <div id="fb-4" class="ai-feedback"></div>
      </div>
    </div>
  </div>

  <div style="text-align:center; margin-top:50px; color:#999; font-size:0.8em;">
    Copyright Â© 2025 Avatar Biology. æ•¸æ“šä¾†æº: NCBI
  </div>
</div>

<script>
  // ==========================================
  // ğŸ”´ å¿…é ˆè¨­å®šå€ï¼šè«‹å¡«å…¥æ‚¨çš„è³‡è¨Š
  // ==========================================
 
  
  // æ‚¨çš„ GAS Web App URL (é€™åœ¨ç¬¬äºŒéƒ¨åˆ†æ­¥é©Ÿä¸­æœƒå–å¾—)
  const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwJN1t0muTkbMAWVXVE8t8b0YbUcK0swMj7qRPTsiride1Bi74p0lA7sefCTTLB8pZK/exec";
  
  // ==========================================

  const database = {
    "Human (äººé¡)": "MGDVEKGKKIFIMKCSQCHTVEKGGKHKTGPNLHGLFGRKTGQAPGYSYTAANKNKGIIWGEDTLMEYLENPKKYIPGTKMIFVGIKKKEERADLIAYLKKATNE",
    "Chimp (é»‘çŒ©çŒ©)": "MGDVEKGKKIFIMKCSQCHTVEKGGKHKTGPNLHGLFGRKTGQAPGYSYTAANKNKGIIWGEDTLMEYLENPKKYIPGTKMIFVGIKKKEERADLIAYLKKATNE",
    "Rhesus (æ†æ²³çŒ´)":"MGDVEKGKKIFIMKCSQCHTVEKGGKHKTGPNLHGLFGRKTGQAPGYSYTAANKNKGITWGEDTLMEYLENPKKYIPGTKMIFVGIKKKEERADLIAYLKKATNE",
    "Mouse (å°é¼ )":   "MGDVEKGKKIFVQKCAQCHTVEKGGKHKTGPNLHGLFGRKTGQAAGFSYTDANKNKGITWGEDTLMEYLENPKKYIPGTKMIFAGIKKKGERADLIAYLKKATNE",
    "Chicken (é›)":   "MGDIEKGKKIFVQKCSQCHTVEKGGKHKTGPNLHGLFGRKTGQAEGFSYTDANKNKGITWGEDTLMEYLENPKKYIPGTKMIFAGIKKKSERVDLIAYLKDATSK",
    "Snake (éŸ¿å°¾è›‡)": "MGDVEKGKKIFSMKCSQCHTVEKGGKHKTGPNLHGLFGRKTGQAVGYSYTAANKNKGITWGEDTLMEYLENPKKYIPGTKMIFVGIKKKEERADLIAYLKDATSK",
    "Tuna (é®ªé­š)":     "MGDVAKGKKTFVQKCAQCHTVENGGKHKVGPNLWGLFGRKTGQAEGYSYTDANKSKGIVWNNDTLMEYLENPKKYIPGTKMIFAGIKKKGERQDLVAYLKSATS-"
  };

  window.onload = function() {
    let html = '';
    for (const [name, seq] of Object.entries(database)) {
      html += `<tr><td width="30"><input type="checkbox" class="cb" value="${name}" checked></td><td width="120"><b>${name.split(' ')[0]}</b></td><td><div class="seq-display">${seq}</div></td></tr>`;
    }
    document.getElementById('species-list-body').innerHTML = html;
  };

  function toggleAll() { document.querySelectorAll('.cb').forEach(cb => cb.checked = true); }

  function compare(s1, s2) {
    let len = Math.min(s1.length, s2.length), m = 0;
    for(let i=0; i<len; i++) if(s1[i]===s2[i]) m++;
    return (m/len)*100;
  }

  function runAnalysis() {
    const whaleSeq = document.getElementById('whale-input').value.trim();
    const cbs = document.querySelectorAll('.cb:checked');
    if(!whaleSeq || cbs.length === 0) return alert("è«‹è¼¸å…¥åºåˆ—ä¸¦å‹¾é¸ç‰©ç¨®ï¼");

    let list = []; cbs.forEach(cb => list.push(cb.value));
    list.push("Whale (é¯¨é­š)");
    const currentData = { ...database, "Whale (é¯¨é­š)": whaleSeq };

    let zValues = [];
    for(let i=0; i<list.length; i++){
      let row = [];
      for(let j=0; j<list.length; j++){
        row.push(compare(currentData[list[i]], currentData[list[j]]));
      }
      zValues.push(row);
    }

    let h = 400 + (list.length * 35);
    var layout = { height: h, margin: {t:50,b:100,l:120,r:50}, xaxis:{tickangle:-45}, yaxis:{autorange:'reversed'}, annotations:[] };
    
    for(let i=0; i<list.length; i++){
      for(let j=0; j<list.length; j++){
        let val = zValues[j][i];
        let color = val > 88 ? 'white' : 'black';
        layout.annotations.push({ xref:'x1', yref:'y1', x:list[i], y:list[j], text:'<b>'+val.toFixed(1)+'</b>', font:{size:14,color:color}, showarrow:false });
      }
    }

    Plotly.newPlot('heatmap', [{ z:zValues, x:list, y:list, type:'heatmap', colorscale:'Blues', zmin:70, zmax:100, xgap:1, ygap:1 }], layout);
    document.getElementById('result-area').style.display = 'block';
    document.getElementById('result-area').scrollIntoView({ behavior: 'smooth' });
  }

  // --- æ”¹å¯«å¾Œçš„ AI è™•ç†é‚è¼¯ (ä¸ä¾è³´ GAS) ---
  async function submitTask(questionId, inputId, feedbackId, btnElement, nextCardId) {
    const studentName = document.getElementById('student-name').value.trim();
    const answer = document.getElementById(inputId).value.trim();
    
    if (studentName.length < 2) {
        alert("âš ï¸ è«‹å…ˆåœ¨ä¸Šæ–¹è¼¸å…¥æ‚¨çš„ã€Œç­ç´š+åº§è™Ÿ+å§“åã€ï¼");
        document.getElementById('student-name').focus();
        return;
    }
    if(answer.length < 2) return alert("è«‹è¼¸å…¥ä½ çš„ç­”æ¡ˆï¼");

    const feedbackBox = document.getElementById(feedbackId);
    const originalText = btnElement.innerText;
    btnElement.disabled = true;
    btnElement.innerHTML = '<div class="loading"></div> åˆ†æä¸­...';
    feedbackBox.style.display = 'none';

    try {
      // 1. å‘¼å« Gemini API (ç›´æ¥åœ¨å‰ç«¯åŸ·è¡Œ)
      const aiResponse = await callGeminiDirect(answer, questionId);
      
      // é¡¯ç¤ºå›é¥‹
      feedbackBox.innerHTML = "<b>ğŸ¤– AI é˜¿å‡¡é”ï¼š</b><br>" + aiResponse.replace(/\n/g, '<br>');
      feedbackBox.style.display = 'block';
      btnElement.innerText = "âœ… å·²å®Œæˆ";

      // 2. å„²å­˜åˆ° Google Sheet (å‘¼å« GAS Web App)
      // ä½¿ç”¨ no-cors æ¨¡å¼ï¼Œå› ç‚ºæˆ‘å€‘åªåœ¨ä¹é€å‡ºï¼Œä¸åœ¨ä¹ GAS å›å‚³ä»€éº¼
      if(GAS_WEB_APP_URL.startsWith("http")) {
         fetch(GAS_WEB_APP_URL, {
            method: 'POST',
            mode: 'no-cors', 
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              studentName: studentName,
              questionId: questionId,
              studentAnswer: answer,
              aiFeedback: aiResponse
            })
         }).catch(err => console.log("Save error:", err)); // èƒŒæ™¯åŸ·è¡ŒéŒ¯èª¤åƒ…ç´€éŒ„ console
      }

      // 3. è§£é–ä¸‹ä¸€é—œ
      if (nextCardId) {
          const nextCard = document.getElementById(nextCardId);
          if (nextCard) {
            setTimeout(() => {
              nextCard.style.display = 'block';
              nextCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 1000); 
          }
      }

    } catch (error) {
      console.error(error);
      feedbackBox.innerHTML = "âš ï¸ é€£ç·šéŒ¯èª¤ï¼š" + error.message;
      feedbackBox.style.display = 'block';
      btnElement.disabled = false;
      btnElement.innerText = originalText;
    }
  }


// å®‰å…¨ç‰ˆï¼šå‘¼å« Netlify Function (Key ä¸æœƒå¤–æ´©)
  async function callGeminiDirect(studentAnswer, questionId) {
     
     // å®šç¾©æç¤ºè© (é€™è£¡å®Œå…¨ä¸ç”¨å‹•)
     let specificPrompt = "";
     switch(questionId) {
        case "q1": specificPrompt = `é¡Œç›®ï¼šè«‹æ¯”è¼ƒé¯¨é­šèˆ‡é®ªé­šã€é¯¨é­šèˆ‡å°é¼ çš„ç›¸ä¼¼åº¦ã€‚æ¨™æº–ï¼šæŒ‡å‡ºã€Œé¯¨é­š vs å°é¼ ã€(>90%) é«˜æ–¼ ã€Œé¯¨é­š vs é®ªé­šã€ã€‚é‡é»ï¼šç¢ºèªæœ‰ç„¡æ­£ç¢ºè®€æ•¸ã€‚`; break;
        case "q2": specificPrompt = `é¡Œç›®ï¼šé¯¨é­šåˆ†é¡èˆ‡å¤–è§€ï¼Ÿæ¨™æº–ï¼šé¯¨é­šå±¬å“ºä¹³é¡ï¼Œå¤–è§€åƒé­šæ˜¯ã€Œè¶¨åŒæ¼”åŒ–ã€ã€‚`; break;
        case "q3": specificPrompt = `é¡Œç›®ï¼šé›èˆ‡è›‡çš„é—œä¿‚ï¼Ÿæ¨™æº–ï¼šé›èˆ‡è›‡ç›¸ä¼¼åº¦é«˜ï¼Œæ”¯æŒã€Œé³¥é¡æºè‡ªæé¾(çˆ¬è¡Œé¡)ã€ã€‚`; break;
        case "q4": specificPrompt = `é¡Œç›®ï¼šäººèˆ‡é»‘çŒ©çŒ©100%ç›¸ä¼¼ç‚ºä½•é•·å¾—ä¸åŒï¼Ÿæ¨™æº–ï¼šåŸºå› èª¿æ§(é–‹é—œ)ã€è¡¨é”é‡ä¸åŒã€‚`; break;
        default: specificPrompt = "çµ¦äºˆç”Ÿç‰©å­¸çš„é¼“å‹µã€‚";
     }

     const systemPrompt = `
      è§’è‰²ï¼šé«˜ä¸­ç”Ÿç‰©èª²çš„ã€ŒAI é˜¿å‡¡é”åŠ©æ•™ã€ã€‚
      è¦å‰‡ï¼š
      1. é‡å°ç­”æ¡ˆåˆ†æã€‚
      2. ğŸˆ² ç¦æ­¢é–‹é ­å•å€™èˆ‡çµå°¾å®¢å¥—ã€‚
      3. ç¹é«”ä¸­æ–‡ï¼Œ80~100å­—ï¼Œèªæ°£è¦ªåˆ‡å¹½é»˜ã€‚
      ${specificPrompt}
     `;

     const url = `/.netlify/functions/askGemini`;
     
     // ç™¼é€è«‹æ±‚
     const response = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          "contents": [{ "parts": [{ "text": systemPrompt + "\n\nå­¸ç”Ÿçš„å›ç­”ï¼š" + studentAnswer }] }]
        })
     });

     // 1. æª¢æŸ¥ Netlify é€£ç·šç‹€æ…‹
     if (!response.ok) {
       throw new Error(`ä¼ºæœå™¨é€£ç·šéŒ¯èª¤: ${response.status} (${response.statusText})`);
     }

     const data = await response.json();

     // 2. ä¿®æ­£é»ï¼šæ­£ç¢ºè§£æ Google å‚³å›çš„éŒ¯èª¤ (é¿å…å‡ºç¾ object Object)
     if(data.error) {
         // å¦‚æœ Google æ‹’çµ•ï¼Œå–å‡ºå…·é«”çš„éŒ¯èª¤è¨Šæ¯
         let msg = data.error.message || "æœªçŸ¥éŒ¯èª¤";
         throw new Error(`Google API éŒ¯èª¤: ${msg}`);
     }

     // 3. æ–°å¢æª¢æŸ¥ï¼šAI æ˜¯å¦å› ç‚ºã€Œå®‰å…¨è¨­å®šã€è€Œæ‹’çµ•å›ç­”ï¼Ÿ
     // (æœ‰æ™‚å€™å­¸ç”Ÿå›ç­”é›–ç„¶æ­£å¸¸ï¼Œä½† AI èª¤åˆ¤ç‚ºæ•æ„Ÿå…§å®¹æœƒå›å‚³ç©ºå€¼ï¼Œå°è‡´ç¨‹å¼å´©æ½°)
     if (!data.candidates || data.candidates.length === 0) {
         throw new Error("AI ä¼¼ä¹åœ¨æ€è€ƒäººç”Ÿï¼Œæ²’æœ‰å›å‚³ä»»ä½•å…§å®¹ (å¯èƒ½æ˜¯è§¸ç™¼äº†å®‰å…¨éæ¿¾æ©Ÿåˆ¶ï¼Œè«‹å˜—è©¦æ›å€‹èªªæ³•)ã€‚");
     }

     return data.candidates[0].content.parts[0].text;
}
</script>

</body>

</html>

